name: Pipeline DevSecOps Tamagotchi

on: [push]

jobs:
  controle-technique:
    runs-on: ubuntu-latest
    steps:
      - name: Recupere le code
        uses: actions/checkout@v3

      - name: Prepare Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Installe les outils
        run: |
          pip install ruff bandit safety flask pytest

      - name: 1. Scan du Code (SAST avec Bandit)
        # ICI : on ignore B101 (les asserts dans les tests) et B104 (le 0.0.0.0)
        run: bandit -r ./api -s B101,B104

      - name: 2. Scan des Librairies (SCA avec Safety)
        run: safety check || echo "Attention aux failles !"

      - name: 3. Verifier la Qualit√© (Ruff)
        run: ruff check ./api